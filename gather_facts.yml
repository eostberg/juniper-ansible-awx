---
- name: Gather facts from Junos devices
  hosts: all
  connection: local
  gather_facts: no
  roles:
    - Juniper.junos
  tasks:
    - name: Save Junos output to destination files
      juniper_junos_command:
        command: 
         - "show version"
         - "show chassis hardware"
        dest: "/root/ansible_tmp/output/{{ inventory_hostname }}.output"    
#      register: response
#
#    - name: Print the command output
#      debug:
#        var: response
#        
    - assemble:
     src: /root/ansible_tmp/output/
     dest: /root/ansible_tmp/output/gather_facts.txt
     delimiter: '-----------------'
     
    - mail:
       host: mail.smtp2go.com
       port: 443
       secure: always
       username: roger.wiklund@gmail.com
       password: KIA0xiK2eo7r
       from: Ansible AWX <ansible-awx@juniper.net>
       to: Roger Wiklund <rwiklund@juniper.net>
       subject: Ansible-report
       body: 'System test has been successfully provisioned.'
       attach: /root/ansible_tmp/gather_facts.txt
      delegate_to: localhost
      run_once: true
