---
- name: Generate common Junos config
  template: src=main.conf.j2 dest=/root/ansible_tmp/config/{{ inventory_hostname }}.conf
  tags: build

- name: Configure Junos devices with common config
  juniper_junos_config:
    timeout: 60
    load: 'set'
    src: "/root/ansible_tmp/config/{{ inventory_hostname }}.conf"
  register: response
  tags: deploy
  
- name: Print config diff
  debug:
   var: "{{ response | from_json | to_nice_yaml }}"
    
- name: Write diff to files                                                                                
  copy:                                                                                              
   content: "{{ response.diff_lines }}"
   dest: "/root/ansible_tmp/output/{{ inventory_hostname }}.diff"
